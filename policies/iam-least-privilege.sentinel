
# IAM Role Least Privilege Policy
# Prevents the use of wildcard (*) permissions in IAM role policies.

policy "iam-least-privilege" {
  import "tfplan/v2" as tfplan

  deny = rule {
    any tfplan.resource_changes as resource {
      resource.type is "aws_iam_role_policy" and
      any resource.change.after.policy as policy {
        policy.contains("*")
      }
    }
  }

  main = rule {
    not deny
  }
}
